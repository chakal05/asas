import { useRouter } from 'next/router';
import Image from 'next/image';
import Head from 'next/head';
import type { InferGetServerSidePropsType, NextPage } from 'next';
import styled from 'styled-components';

const mockList = [
	{
		category: "women's clothing",
		description:
			'95%Cotton,5%Spandex, Features: Casual, Short Sleeve, Letter Print,V-Neck,Fashion Tees, The fabric is soft and has some stretch., Occasion: Casual/Office/Beach/School/Home/Street. Season: Spring,Summer,Autumn,Winter.',
		image: 'https://fakestoreapi.com/img/61pHAEJ4NML._AC_UX679_.jpg',
		city: 'Djibouti City',
		added: '2022-01-17',
		sellerId: '62470a417e53beb38dae2af6',
		price: 12.99,
		title: 'DANVOUY Womens T Shirt Casual Cotton Short',
	},
	{
		category: "women's clothing",
		description:
			'95%Cotton,5%Spandex, Features: Casual, Short Sleeve, Letter Print,V-Neck,Fashion Tees, The fabric is soft and has some stretch., Occasion: Casual/Office/Beach/School/Home/Street. Season: Spring,Summer,Autumn,Winter.',
		image: 'https://fakestoreapi.com/img/61pHAEJ4NML._AC_UX679_.jpg',
		city: 'Djibouti City',
		added: '2022-01-17',
		sellerId: '62470a417e53beb38dae2af6',
		price: 12.99,
		title: 'DANVOUY Womens T Shirt Casual Cotton Short',
	},
	{
		category: "women's clothing",
		description:
			'95%Cotton,5%Spandex, Features: Casual, Short Sleeve, Letter Print,V-Neck,Fashion Tees, The fabric is soft and has some stretch., Occasion: Casual/Office/Beach/School/Home/Street. Season: Spring,Summer,Autumn,Winter.',
		image: 'https://fakestoreapi.com/img/61pHAEJ4NML._AC_UX679_.jpg',
		city: 'Djibouti City',
		added: '2022-01-17',
		sellerId: '62470a417e53beb38dae2af6',
		price: 12.99,
		title: 'DANVOUY Womens T Shirt Casual Cotton Short',
	},
	{
		category: "women's clothing",
		description:
			'95%Cotton,5%Spandex, Features: Casual, Short Sleeve, Letter Print,V-Neck,Fashion Tees, The fabric is soft and has some stretch., Occasion: Casual/Office/Beach/School/Home/Street. Season: Spring,Summer,Autumn,Winter.',
		image: 'https://fakestoreapi.com/img/61pHAEJ4NML._AC_UX679_.jpg',
		city: 'Djibouti City',
		added: '2022-01-17',
		sellerId: '62470a417e53beb38dae2af6',
		price: 12.99,
		title: 'DANVOUY Womens T Shirt Casual Cotton Short',
	},
	{
		category: "women's clothing",
		description:
			'95%Cotton,5%Spandex, Features: Casual, Short Sleeve, Letter Print,V-Neck,Fashion Tees, The fabric is soft and has some stretch., Occasion: Casual/Office/Beach/School/Home/Street. Season: Spring,Summer,Autumn,Winter.',
		image: 'https://fakestoreapi.com/img/61pHAEJ4NML._AC_UX679_.jpg',
		city: 'Djibouti City',
		added: '2022-01-17',
		sellerId: '62470a417e53beb38dae2af6',
		price: 12.99,
		title: 'DANVOUY Womens T Shirt Casual Cotton Short',
	},
	{
		category: "women's clothing",
		description:
			'95%Cotton,5%Spandex, Features: Casual, Short Sleeve, Letter Print,V-Neck,Fashion Tees, The fabric is soft and has some stretch., Occasion: Casual/Office/Beach/School/Home/Street. Season: Spring,Summer,Autumn,Winter.',
		image: 'https://fakestoreapi.com/img/61pHAEJ4NML._AC_UX679_.jpg',
		city: 'Djibouti City',
		added: '2022-01-17',
		sellerId: '62470a417e53beb38dae2af6',
		price: 12.99,
		title: 'DANVOUY Womens T Shirt Casual Cotton Short',
	},
];

const ImageWrap = styled.span`
	box-sizing: content-box;
	display: flex;
	flex-direction: column;
	justify-content: center;
	align-items: center;

	& > span {
	}
`;

const Product = ({
	product,
	sellerInfo,
	sameCategorie,
}: InferGetServerSidePropsType<typeof getServerSideProps>) => {
	const { title, description, image, price } = product;

	return (
		<div>
			<Head>
				<title> Sams - {title} </title>
				<meta name='description' content='Generated by create next app' />
				<link rel='icon' href='/favicon.ico' />
			</Head>

			<div className='md:flex'>
				<div className=' p-1 mx-1 mt-1 md:basis-4/6 '>
					<div className='p-5 w-4/5 mx-auto text-center '>
						<Image
							src={image as any}
							width='300px'
							height='300px'
							alt='title'
						/>
					</div>

					<div className='mt-7'>
						<div className='grid grid-cols-2 '>
							<div>
								<p className='text-2xl  '> {title} </p>
								<p className='my-3 font-bold text-xl '> {price} Fdj </p>
							</div>
							<div className='text-right '>
								<button className='bg-slate-600 text-white p-1 w-16 rounded '>
									{' '}
									SAVE{' '}
								</button>
							</div>
						</div>
						<div className=' my-5 w-full border-b border-gray-300'></div>
						<div className='my-8 lg:flex justify-between '>
							<p className='text-lg '>
								{' '}
								Published by :{' '}
								<span className='font-bold '>{sellerInfo.username}</span>
							</p>
							<p className='w-full'>
								{' '}
								Member since: <span> {sellerInfo.joined} </span>{' '}
							</p>

							<button className='mb-5 bg-slate-600 text-white w-full lg:w-40 rounded p-2'>
								{' '}
								SEND MESSAGE{' '}
							</button>
						</div>
						<div>
							<p className='font-bold text-lg '>
								{' '}
								Description : <br />{' '}
								<span className='font-thin'> {description}</span>{' '}
							</p>
						</div>
					</div>
				</div>

				<div className=' hidden md:block md:basis-2/6 md:ml-3  '>
					<div className='border-2 rounded-lg shadow-lg p-2'>
						<p className='font-bold text-center text-xl'>
							{' '}
							Browse job listings{' '}
						</p>
						<ul className='my-3 divide-y'>
							<li className=''>
								<p className='font-bold'>
									Lagerarbetare till långsiktigt projekt! - Möjlighet till
									resjobb!
								</p>
								<p className='text-slate-500 text-sm '>
									MTX Rekrytering & Bemanning ·{' '}
									<span className='text-cyan-500 font-bold'>
										{' '}
										31 dagar kvar{' '}
									</span>{' '}
								</p>
							</li>
							<li className=''>
								<p className='font-bold'>
									Lagerarbetare till långsiktigt projekt! - Möjlighet till
									resjobb!
								</p>
								<p className='text-slate-500 text-sm '>
									MTX Rekrytering & Bemanning ·{' '}
									<span className='text-cyan-500 font-bold'>
										{' '}
										31 dagar kvar{' '}
									</span>{' '}
								</p>
							</li>
						</ul>
						<button className='bg-slate-500 text-white p-2 w-full rounded-lg'>
							{' '}
							See more{' '}
						</button>
						<p className='text-5xl text-center  '> Sams Job </p>
					</div>
				</div>
			</div>
			<div className='bg-slate-50 mt-12 '>
				<p className='text-2xl p-3 font-bold'> Others also looked at </p>
				<ul className='grid grid-cols-2 gap-4 p-3 '>
					{sameCategorie.map((item, index) => {
						return (
							<li key={index} className=' bg-white shadow-lg rounded-lg'>
								<ImageWrap>
									<Image src={item.image} width={150} height={150} alt='ds' />
								</ImageWrap>
								<div className='p-1'>
									<p className='text-slate-600'> {item.city} </p>
									<p className='text-lg'> {item.title}</p>
									<p className='font-bold'> {item.price} </p>
								</div>
							</li>
						);
					})}
				</ul>
			</div>
		</div>
	);
};

export const getServerSideProps = async (context) => {
	const { id } = context.query;

	const res = await fetch(`http://localhost:3000/api/products/?id=${id}`);
	const product = await res.json();
	//JSON.parse(JSON.stringify(res));

	// get sellerId name
	const { sellerId, category } = product;
	const seller = await fetch(
		`http://localhost:3000/api/products/?sellerId=${sellerId}`
	);
	const sellerInfo = await seller.json();

	// get products of same categorie

	const productCategorie = await fetch(
		`http://localhost:3000/api/products/?category=${category}`
	);
	const sameCategorie = await productCategorie.json();

	return {
		props: { product, sellerInfo, sameCategorie },
	};
};

export default Product;
